<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Simple Chat</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

    <style>
        body {
            font-family: Poppins, Arial;
            background: #1c1f22;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: white;
            margin: 0;
        }

        .chat-container {
            width: 420px;
            background: #2b2f33;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.4);
        }

        .title {
            text-align: center;
            margin-bottom: 10px;
            font-size: 22px;
            font-weight: bold;
        }

        #messageArea {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            height: 420px;
            overflow-y: auto;
            scrollbar-width: thin;
        }

        #messageArea::-webkit-scrollbar {
            width: 6px;
        }
        #messageArea::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 10px;
        }
        #messageArea::-webkit-scrollbar-track {
            background: #2b2f33;
        }

        #messageArea li {
            list-style: none;
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 14px;
            font-size: 15px;
            line-height: 1.35;
            word-wrap: break-word;
            word-break: break-word;
        }

        .my-message {
            background: #006eff;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .other-message {
            background: #444a50;
            color: #fff;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .join, .leave {
            text-align: center;
            font-size: 13px;
            width: 100%;
            font-style: italic;
            opacity: 0.85;
            margin: 4px 0;
        }

        .join { color: #28c76f; }
        .leave { color: #ff9f43; }

        .input-row {
            display: flex;
            margin-top: 10px;
        }
        input {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            outline: none;
            background: #3b4047;
            color: white;
            font-size: 14px;
        }
        button {
            margin-left: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            background: #006eff;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
        }
        button:hover {
            background: #007bff;
        }
    </style>
</head>

<body>

<div class="chat-container">

    <div class="title">Simple Chat üí¨</div>

    <div id="username-page">
        <input type="text" id="name" placeholder="Nh·∫≠p t√™n b·∫°n...">
        <button onclick="connect()">V√†o ph√≤ng</button>
    </div>

    <div id="chat-page" style="display:none;">
        <ul id="messageArea"></ul>

        <div class="input-row">
            <input type="text" id="message" placeholder="Nh·∫≠p n·ªôi dung..." 
                onkeypress="if(event.key==='Enter') sendMessage()">
            <button onclick="sendMessage()">G·ª≠i</button>
        </div>
    </div>
</div>


<script>
    var stompClient = null;
    var username = null;

    function connect() {
        username = document.getElementById("name").value.trim();
        if (!username) return;

        var socket = new SockJS('/ws');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function () {
            document.getElementById("username-page").style.display="none";
            document.getElementById("chat-page").style.display="block";

            stompClient.subscribe("/topic/public",
                (payload)=> showMessage(JSON.parse(payload.body))
            );

            stompClient.send("/app/chat.addUser", {}, 
                JSON.stringify({ sender: username, type: "JOIN" })
            );
        });
    }

    function sendMessage() {
        var msg = document.getElementById("message").value.trim();
        if(msg === "") return;

        stompClient.send("/app/chat.sendMessage", {}, 
            JSON.stringify({ sender: username, content: msg, type: "CHAT" })
        );
        document.getElementById("message").value = "";
    }

    function showMessage(message) {
        var area = document.getElementById("messageArea");
        var li = document.createElement("li");

        if(message.type === "JOIN") {
            li.className="join";
            li.textContent = message.sender + " ƒë√£ tham gia";
        }
        else if(message.type === "LEAVE") {
            li.className="leave";
            li.textContent = message.sender + " ƒë√£ r·ªùi ph√≤ng";
        }
        else {
            li.className = (message.sender === username) ? "my-message" : "other-message";
            li.innerHTML = `<strong>${message.sender}</strong><br>${message.content}`;
        }

        area.appendChild(li);
        area.scrollTop = area.scrollHeight;
    }
</script>

</body>

</html>
